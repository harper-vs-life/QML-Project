---
title: "QML Group Project"
format: pdf
---

# Packages

```{r}
library(tidyverse)
library(brms)
library(bayesplot)
library(ggdist)
library(posterior)
```

# Data Preprocessing

Because the original data was in Croatian and thus difficult for us to interpret, we translated column names and word class values to English. We also dropped any unneeded columns.

## Read in Data
```{r}
original1 = read_tsv("./data/megahr.tsv")
original2 = read_tsv("./data/megahr.2nd.tsv")
original <- rbind(original1, original2)
```

## Drop Unnecessary Columns
```{r}
original <- original[-c(7:20,49:62)] #remove unneccessary types
original <- original[-c(7,9:21,23:34)] #remove all but the mean for clarity
```

## Translate Column Names to English
```{r}
original <- original|>
  rename(
    token = 'leksem',
    word_class = 'vrsta.riječi',
    gender = 'rod',
    animacy = 'živost',
    number_of_letters = 'broj.slova',
    freq = 'frek'
  )

original <- original|>
  rename(
    subjective_frequency_mean = 'č.M',
    imageability_mean = 'p.M'
  )

```

## Translate Word Classes to English
```{r}
original <- original|>
  mutate(word_class = case_when(
    word_class == "Nc" ~ "noun",
    word_class == "Vm" ~ "verb",
    word_class == "Ag" ~ "adj",
    word_class == "Rg" ~ "adv"
  ))
```

## Transform Word Class into Factor
```{r}
original <- original|>
  mutate(word_class = as.factor(word_class))
```



# Effect of Word Class on Imageability

## Data Plots

```{r}
original |> 
  ggplot(aes(imageability_mean, fill = word_class)) +
  geom_density(alpha = 0.5)
```

```{r}
original |>
  ggplot(aes(word_class, imageability_mean, fill = word_class)) +
  geom_jitter(alpha = 0.15, width = 0.1) +
  geom_violin(width = 0.2) +
  scale_fill_brewer(palette = "Dark2")
```

## Summary of Imageability Score Means by Word Class

```{r}
original_summ <- original |> 
  group_by(word_class) |> 
  summarise(
    mean(imageability_mean), median(imageability_mean), sd(imageability_mean)
  )

original_summ
```

## Fit Regression Model

```{r}
img_bm <- brm(
  imageability_mean ~ word_class,
  family = gaussian,
  data = original,
  seed = 6725,
  file = "cache/img_bm"
)
```

```{r}
summary(img_bm)
```

## Results

### Posterior Plots
```{r}
mcmc_dens(img_bm, pars = vars(starts_with("b_")))
```

### Get Draws
```{r}
img_bm_draws <- as_draws_df(img_bm) |> 
  mutate(
    adj = b_Intercept,
    adv = b_Intercept + b_word_classadv,
    noun = b_Intercept + b_word_classnoun,
    verb = b_Intercept + b_word_classverb
  )

img_bm_long <- img_bm_draws |> 
  select(adj:verb) |> 
  pivot_longer(everything(), names_to = "word_class", values_to = "pred")

img_bm_long
```

### Table 1: Imageability Mean, SD, and CrIs by Word Class
```{r}
img_bm_tab <- img_bm_long |> 
  group_by(word_class) |> 
  summarise(
    mean = mean(pred), sd = sd(pred),
    `99%` = paste0("[", paste(quantile2(pred, c(0.005, 0.995)) |> round(2), collapse = ", "), "]"),
    `95%` = paste0("[", paste(quantile2(pred, c(0.025, 0.975)) |> round(2), collapse = ", "), "]"),
    `75%` = paste0("[", paste(quantile2(pred, c(0.125, 0.875)) |> round(2), collapse = ", "), "]")
  )

img_bm_tab
```

```{r}
img_bm_tab |> 
  knitr::kable(
    col.names = c("", "Mean", "SD", "99% CrI", "95% CrI", "60% CrI"),
    digits = 1, align = c("rcccc")
  )
```

## Reporting

We fitted a Bayesian regression model to the mean imageability score of Croatian words. We used a Gaussian distribution for the outcome and word class (adjective, adverb, noun, verb) as the only predictor. Word class was coded using the default treatment coding.

According to the model, the mean imageability score of adjectives is between 3.33 and 3.40, of adverbs is between 3.01 and 3.18, of nouns is between 3.82 and 3.87, and of verbs is between 3.54 and 3.62, at 95% probability.

Table 1 reports mean, SD, and 99% and 75% CrIs.

When comparing adverbs, nouns, and verbs to adjectives, at 95% confidence, the mean imageability score of adverbs is 0.18 to 0.37 points lower than that of adjectives (mean = 0.28, SD = 0.05), while the mean imageability score of nouns is 0.43 to 0.52 points higher than that of adjectives (mean = 0.48, SD = 0.02), and the mean imageability score of verbs is 0.16 to 0.26 points higher than that of adjectives (mean = 0.21, SD = 0.03)

## Comparison to Original Study

The findings from this Bayesian analysis were similar to the findings from a frequentist analysis of the same data in Peti-Stantić et al. (2021). As in the original study, we found evidence that mean imageability score is highest for nouns, followed by verbs, then adjectives, then adverbs. As the 99% credible intervals for mean imageability score do not overlap, the posteriors suggest differences between word classes.



# Effect of Word Class on Subjective Frequency

## Plotting the Types
```{r}
original |> 
  drop_na(word_class) |> 
  ggplot(aes(subjective_frequency_mean, fill = word_class)) +
  geom_density(alpha = 0.5)
```


## Examining the Data Structure
```{r}
original |>
  ggplot(aes(word_class, subjective_frequency_mean, fill = word_class)) +
  geom_jitter(alpha = 0.15, width = 0.1) +
  geom_violin(width = 0.2) +
  scale_fill_brewer(palette = "Dark2")
```

## Summarising the Data by Word Class
```{r}
original_summ <- original |> 
  group_by(word_class) |> 
  summarise(
    mean(subjective_frequency_mean)
  ) 

original_summ
```


## Creating a Regression Model of the Data
```{r}
subj_freq_bm <- brm(
  subjective_frequency_mean ~ word_class,
  family = gaussian,
  data = original,
  seed = 6725,
  file = "cache/subj_freq_bm"
)
```


## Show Results of Model
```{r}
summary(subj_freq_bm)
```


## Mutate the Draws
```{r}
subj_freq_bm_draws <- as_draws_df(subj_freq_bm) |> 
  mutate(
    adj = b_Intercept,
    adv = b_Intercept + b_word_classadv,
    noun = b_Intercept + b_word_classnoun,
    verb = b_Intercept + b_word_classverb
  )
```


## Table Summarization
```{r}
subj_freq_bm_long <- subj_freq_bm_draws |> 
  select(adj:verb) |> 
  pivot_longer(everything(), names_to = "word_class", values_to = "pred")

subj_freq_bm_tab <- subj_freq_bm_long |> 
  group_by(word_class) |> 
  summarise(
    mean = mean(pred), sd = sd(pred),
    `99%` = paste0("[", paste(quantile2(pred, c(0.005, 0.995)) |> round(2), collapse = ", "), "]"),
    `95%` = paste0("[", paste(quantile2(pred, c(0.025, 0.975)) |> round(2), collapse = ", "), "]"),
    `75%` = paste0("[", paste(quantile2(pred, c(0.125, 0.875)) |> round(2), collapse = ", "), "]")
  )

subj_freq_bm_tab
```


## Nicer Table
```{r}
subj_freq_bm_tab |> 
  knitr::kable(
    col.names = c("", "Mean", "SD", "99% CrI", "95% CrI", "75% CrI"),
    digits = 2, align = c("rccccc")
  )
```

## Reporting
We fitted a Bayesian regression model to Mean Subjective Frequency (MSF) of Croatian words, measured on a Likert scale between 1 and 5. We used a Gaussian distribution for the outcome and word class (adjective, adverb, noun, verb) as the only predictor. Word class was treated as a default factored input.

According to the model, the mean MSF of adjectives is between 3.14 and 3.22, of adverbs is between 3.82 and 4.00, of nouns is between 3.21 and 3.27, and of verbs is between 3.42 and 3.49, at 95% probability. The table above reports mean, SD, 99%, 95% and 75% CrIs. When comparing the word classes at 95% confidence, adverbs were rated 0.64-0.83 more frequently used (mean = 3.91, SD = 0.05) than adjectives (mean = 3.18, SD = 0.02). Additionally, nouns were rated 0.02-0.11 more frequently used (mean = 3.24, SD = 0.02) and verbs were rated 0.22-0.33 more frequently used (mean = 3.46, SD = 0.03) than adjectives.

Compared to Peti-Stantić et al. (2021), we found evidence of similar trends in the mean of subjective frequency, with there being a large difference in the means of adverbs and verbs as compared to the mean of adjectives. However, in contrast to the study, which found there to be no 'significant' difference in the means in subjective frequency of nouns and adjectives, we can conclude with 95% confidence that there is a small but positive difference in the mean of nouns as compared to adjectives.